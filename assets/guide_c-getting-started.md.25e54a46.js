import{_ as e,c as s,o as a,d as n}from"./app.aa7b13f3.js";const o="/assets/visual-studio-retarget-solution.6abad335.png",t="/assets/visual-studio-build-menu.7965e79e.png",l="/assets/cmake-gui.5c17440b.png",i="/assets/clion-open-project-wizard.78fdd93c.png",p="/assets/flat-planet-result.6d719821.png",A=JSON.parse('{"title":"Getting Started with C","description":"","frontmatter":{},"headers":[{"level":2,"title":"Getting started","slug":"getting-started","link":"#getting-started","children":[{"level":3,"title":"Official repository","slug":"official-repository","link":"#official-repository","children":[]},{"level":3,"title":"Template","slug":"template","link":"#template","children":[]},{"level":3,"title":"SPVanilla","slug":"spvanilla","link":"#spvanilla","children":[]},{"level":3,"title":"Symlinks","slug":"symlinks","link":"#symlinks","children":[]}]},{"level":2,"title":"Vertex Terrain Generation","slug":"vertex-terrain-generation","link":"#vertex-terrain-generation","children":[]},{"level":2,"title":"Biome and Climate assignment","slug":"biome-and-climate-assignment","link":"#biome-and-climate-assignment","children":[]},{"level":2,"title":"Particle Engine","slug":"particle-engine","link":"#particle-engine","children":[]},{"level":2,"title":"Common mistakes","slug":"common-mistakes","link":"#common-mistakes","children":[{"level":3,"title":"Wrong folder name","slug":"wrong-folder-name","link":"#wrong-folder-name","children":[]},{"level":3,"title":"File in use or Cannot open file [your.dll]","slug":"file-in-use-or-cannot-open-file-your-dll","link":"#file-in-use-or-cannot-open-file-your-dll","children":[]}]}],"relativePath":"guide/c-getting-started.md","lastUpdated":1664014626000}'),r={name:"guide/c-getting-started.md"},c=n('<h1 id="getting-started-with-c" tabindex="-1">Getting Started with C <a class="header-anchor" href="#getting-started-with-c" aria-hidden="true">#</a></h1><p>Certain tasks are too performance intensive to implement in Lua, these tasks are implemented in C. Currently the following tasks are done in C:</p><ul><li>Vertex Terrain Generation</li><li>Biome and Climate assignment</li><li>Particles</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>This is considered an advanced topic. If you&#39;re new, try <a href="/guide/lua-getting-started.html">Getting Started with Lua</a></p></div><h2 id="getting-started" tabindex="-1">Getting started <a class="header-anchor" href="#getting-started" aria-hidden="true">#</a></h2><details class="details custom-block"><summary>Prerequisites</summary><ul><li><a href="https://git-scm.com/" target="_blank" rel="noreferrer">Git</a></li><li><a href="https://visualstudio.microsoft.com/" target="_blank" rel="noreferrer">Visual Studio 2017</a> or later Desktop development with C++ <ul><li>When using a different IDE than Visual Studio for development only the <a href="https://visualstudio.microsoft.com/downloads/?q=build+tools" target="_blank" rel="noreferrer">build tools</a> is enough.</li></ul></li><li><a href="https://cmake.org/" target="_blank" rel="noreferrer">CMake</a> if using the template, or an IDE that has CMake bundled like <a href="https://www.jetbrains.com/clion/" target="_blank" rel="noreferrer">CLion</a></li></ul></details><p>C Mods have a file structure very familiar to normal Lua mods. The root folder contains a <code>modInfo.lua</code> file, exactly like a normal Lua mod. For more information on this check out the <a href="/guide/lua-getting-started.html">Getting Started with Lua</a> page. Additionally the root folder contains a <code>lib</code> folder. This lib folder contains library files which the game will load. On windows these library files have the <code>.dll</code> extension.</p><p>The easiest way to get started is by cloning either the <a href="https://github.com/Majic-Jungle/sapiens-mod-creation/" target="_blank" rel="noreferrer">official example repository</a> or the <a href="https://github.com/suppergerrie2/SapiensCModTemplate" target="_blank" rel="noreferrer">template made by suppergerrie2</a>. The template has the benefit of being a clean setup without the other Lua mod examples. Note that both repositories need to be cloned with the <code>--recurse-submodules</code>.</p><h3 id="official-repository" tabindex="-1">Official repository <a class="header-anchor" href="#official-repository" aria-hidden="true">#</a></h3><p>The official example repository contains an example C Mod that can be found in <code>Examples\\src\\FlatTerrain</code>. The <code>Windows\\FlatTerrainMod.sln</code> can be opened in Visual Studio. When opening the project it may ask to be updated to the latest version, let it do that. If it doesn&#39;t ask it and building fails with <code>The build tools for Visual Studio 2017 (Platform Toolset = &#39;v141&#39;) cannot be found</code> you can manually upgrade the project by right clicking the solution and clicking <code>Retarget solution</code>. <img src="'+o+'" alt=""> the mod can be compiled by <code>Build -&gt; Build FlatTerrainMod</code>. This will generate a <code>dll</code> file in <code>Windows\\Build\\</code>. This <code>dll</code> file should be moved into your mod&#39;s <code>lib</code> folder. <img src="'+t+`" alt=""></p><h3 id="template" tabindex="-1">Template <a class="header-anchor" href="#template" aria-hidden="true">#</a></h3><p>If using the template the project can be opened using any IDE that supports CMake, or compiled manually from the command line. The template will combine the <code>modInfo.lua</code> and create the <code>lib</code> folder for you, the resulting folder can be found in the build folder and is named based on the <code>mod id</code> configured at the start.</p><p>The template is setup as a GitHub template, thus it can be easily used to create your own GitHub repository by going to the <a href="https://github.com/suppergerrie2/SapiensCModTemplate" target="_blank" rel="noreferrer">repository</a> and pressing <code>Use this template</code>. This will then ask you to enter the name of your mod and whether it should be public or private and then create the GitHub repository. Copy the Git URL by pressing <code>Code =&gt; Local</code> and then copying the URL.</p><h4 id="command-line-setup" tabindex="-1">Command line setup <a class="header-anchor" href="#command-line-setup" aria-hidden="true">#</a></h4><p>First the repository needs to be cloned.</p><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#A6ACCD;">git clone --recurse-submodules </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">your Git URL</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><p>Then configure the CMake project</p><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">Your GitHub repository name</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">cmake -DMOD_ID=MyCMod -DMOD_NAME=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">My C Mod</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -DDESCRIPTION=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">An amazing mod that does things in C</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -DDEVELOPER=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Me!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -DDEVELOPER_URL=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.com</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -DPREVIEW_FILE=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">preview.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -DMOD_MAJOR_VERSION=1 -DMOD_MINOR_VERSION=2 -DMOD_PATCH_VERSION=3 </span><span style="color:#82AAFF;">.</span><span style="color:#A6ACCD;"> -B build</span></span>
<span class="line"></span></code></pre></div><p>Don&#39;t be afraid of the long line, it&#39;s defining a lot of values you should change yourself. The version is combined as <code>major.minor.patch</code>.</p><details class="details custom-block"><summary>CMake gui</summary><p>You can also configure the project using <code>cmake-gui</code> which comes shipped with CMake by default!</p><p>Select the folder where you cloned to and create a folder where to build to (<code>build</code> in the screenshot below), then press configure. <img src="`+l+`" alt=""></p><p>In the window that opens select the Visual Studio version you installed and press <code>Finish</code>. After this all settings show up in a nice gui!</p></details><p>After this you can build the mod.</p><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> build</span></span>
<span class="line"><span style="color:#A6ACCD;">cmake --build </span><span style="color:#82AAFF;">.</span></span>
<span class="line"></span></code></pre></div><p>You can then find the build mod in <code>build/[MOD ID]</code>, it should contain one file and one folder.</p><div class="language-sh"><button class="copy"></button><span class="lang">sh</span><pre><code><span class="line"><span style="color:#A6ACCD;">ls</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">     Directory: MyCMod\\build\\MyCMod</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Mode                 LastWriteTime         Length Name</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ----                 -------------         ------ ----</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> d----          19/08/2022    16:53                lib</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -a---          19/08/2022    14:46            300 modInfo.lua</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">     Directory: MyCMod\\build\\MyCMod\\lib</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> Mode                 LastWriteTime         Length Name</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ----                 -------------         ------ ----</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> -a---          19/08/2022    16:53          52224 MyCMod.dll</span></span>
<span class="line"></span></code></pre></div><h4 id="clion-setup" tabindex="-1">CLion Setup <a class="header-anchor" href="#clion-setup" aria-hidden="true">#</a></h4><p>Create a new project from version control by selecting <code>File =&gt; New =&gt; Project from Version Control</code>, in the UI that pops up enter your Git URL. Select where to clone to and press <code>Clone</code>.</p><details class="details custom-block"><summary>GitHub Authentication</summary><p>CLion may ask you to authenticate with GitHub, press <code>Login</code> and follow the instructions to authenticate with GitHub</p></details><p>After cloning finishes a window pops up asking for configuration. <img src="`+i+`" alt=""> In the <code>Toolchain</code> make sure it uses <code>Visual Studio</code>, if <code>Visual Studio</code> is not available press <code>Manage toolchains</code> and add a <code>Visual Studio</code> toolchain.</p><p>Press <code>Ok</code> to continue.</p><p>Now it&#39;s time to configure all settings. Open the <code>CMake</code> tab at the bottom, press the small gear at the left of the tab and open <code>CMake Settings</code>. In the tab that opens you can configure the <code>Cache variables</code> by opening the <code>Cache variables</code> dropdown if it&#39;s not opened by default. Change the values to match your mod (Name, Description, etc.) and press <code>Apply</code>.</p><p>You can now build your mod by pressing the green hammer at the top. By default CLion uses the <code>cmake-build-debug</code> folder, in here a folder with as name your chosen Mod ID will be created which you can copy over to the game&#39;s mod folder (or create a symlink to).</p><h3 id="spvanilla" tabindex="-1">SPVanilla <a class="header-anchor" href="#spvanilla" aria-hidden="true">#</a></h3><p>The <a href="https://github.com/Majic-Jungle/splugins/tree/main/SPVanilla" target="_blank" rel="noreferrer">splugins</a> repository contains the vanilla code, this can be used as a reference when working on your own mod.</p><h3 id="symlinks" tabindex="-1">Symlinks <a class="header-anchor" href="#symlinks" aria-hidden="true">#</a></h3><p>A symlink to your mod can be made for easy development, making it so you do not have to manually copy the folder to the game&#39;s mods folder every time you compile. The template can setup this symlink automatically, to do this the project should be configured with <code>AUTO_GENERATE_SAPIENS_MOD_SYMLINK</code> set to <code>ON</code> and with admin permissions. The symlink can also be manually made by running <code>ni [YOUR MOD NAME] -i SymbolicLink -ta [PATH TO WHERE YOUR MOD COMPILES TO]</code> in a powershell instance with admin privileges.</p><h2 id="vertex-terrain-generation" tabindex="-1">Vertex Terrain Generation <a class="header-anchor" href="#vertex-terrain-generation" aria-hidden="true">#</a></h2><p>Vertex Terrain generation determines the height of every point in the world. This height is represented in the <a href="/docs/visuals/coordinates.html">prerender coordinate scale</a>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can convert meters into the prerender scale by using the <code>SP_METERS_TO_PRERENDER</code> macro:</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> heightInPrerenderScale </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SP_METERS_TO_PRERENDER</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">heightInMeters</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div></div><p>Most of the paramaters are still a mystery.</p><p>The <code>pointNormal</code> parameter is the location on the planet normalised, you can imagine it as sampling points on a sphere with <code>(0,0,0)</code> as the center and a radius of <code>1</code>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can calculate the latitude and longitude as follows:</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> lat </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">asin</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pointNormal.y</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> lon </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">fabs</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pointNormal.x</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fabs</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pointNormal.z</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0000001</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        lon </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">atan2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">pointNormal</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">z</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pointNormal</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">x</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Some points are <code>NaN</code>, the vanilla implementation returns <code>NaN</code> at these points. Returning anything else seems to cause artifacts on the equator of the planet.</p></div><p>The return value from te function is a vector with 4 components. The first component is the height, the other components are currently unknown and in the vanilla implementation always <code>riverDistance</code>, <code>0</code> and <code>0</code> respectively.</p><p>Below is the code for the <code>FlatTerrainMod</code> which returns a height of 10 for every position in the world and generates a planet that has flat terrain.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SPHeight.h</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">bool</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">spReplacesPreviousHeight</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">SPVec4 </span><span style="color:#82AAFF;">spHeightGet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">SPVec4 </span><span style="color:#A6ACCD;">previousHeight</span><span style="color:#89DDFF;">,</span><span style="color:#676E95;"> //if spReplacesPreviousHeight returns false, then previousHeight is the output of the previous mod, otherwise it should be ignored.</span></span>
<span class="line"><span style="color:#A6ACCD;">                   SPNoise</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">noise1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   SPNoise</span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">noise2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   SPVec3 </span><span style="color:#A6ACCD;">pointNormal</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   SPVec3 </span><span style="color:#A6ACCD;">noiseLoc</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   SPWorldGenOptions </span><span style="color:#A6ACCD;">worldGenOptions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">riverValue</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                   </span><span style="color:#C792EA;">double</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">riverDistance</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    SPVec4 result </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#82AAFF;">SP_METERS_TO_PRERENDER</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">),</span><span style="color:#F07178;"> riverDistance</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.0</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><details class="details custom-block"><summary>Result of the above code</summary><p><img src="`+p+'" alt=""></p></details><h2 id="biome-and-climate-assignment" tabindex="-1">Biome and Climate assignment <a class="header-anchor" href="#biome-and-climate-assignment" aria-hidden="true">#</a></h2><p>It&#39;s currently unknown how biome and climate assignment works, the vanilla implementation can be found in the <a href="https://github.com/Majic-Jungle/splugins/blob/main/SPVanilla/src/SPBiome.c" target="_blank" rel="noreferrer">splugins</a> repository.</p><h2 id="particle-engine" tabindex="-1">Particle Engine <a class="header-anchor" href="#particle-engine" aria-hidden="true">#</a></h2><p>It&#39;s currently unknown how the particle engine works, the vanilla implementation can be found in the <a href="https://github.com/Majic-Jungle/splugins/blob/main/SPVanilla/src/SPParticles.c" target="_blank" rel="noreferrer">splugins</a> repository.</p><h2 id="common-mistakes" tabindex="-1">Common mistakes <a class="header-anchor" href="#common-mistakes" aria-hidden="true">#</a></h2><p>Some mistakes are easy to make, here is a list of mistakes that are commonly made and their fixes.</p><h3 id="wrong-folder-name" tabindex="-1">Wrong folder name <a class="header-anchor" href="#wrong-folder-name" aria-hidden="true">#</a></h3><p>The folder in the root folder should be named <code>lib</code> and not <code>libs</code>, if it&#39;s the wrong name the game will not load anything nor throw an error.</p><h3 id="file-in-use-or-cannot-open-file-your-dll" tabindex="-1"><code>File in use</code> or <code>Cannot open file [your.dll]</code> <a class="header-anchor" href="#file-in-use-or-cannot-open-file-your-dll" aria-hidden="true">#</a></h3><p>When the game has loaded the mod it will keep it loaded in memory until the game is closed, this means that after testing the mod you always need to fully close the game before you can recompile or overwrite the dll. Just closing the world or going back to the main screen is not enough. Even unchecking the mod in the mods selector is not enough.</p>',56),d=[c];function h(u,y,m,D,g,C){return a(),s("div",null,d)}const f=e(r,[["render",h]]);export{A as __pageData,f as default};
